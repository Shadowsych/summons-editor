<html>
<body>

	<header>
		<title>SLT - Play</title>
		<!--style.css, googlefont, materializecss-->
		<link href="styles/indexstyles.css" type="text/css" rel="stylesheet">
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">

		<!--jquery, jqueryui, materializejs-->
		<script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
		<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
		
	</header>

	<main>
		<!--navbar-->
		<nav>
			<div class="nav-wrapper" id="nav-background">
				<ul class="left hide-on-med-and-down">
				<li><a href="index.html" id="nav-buttons" style="background-color: #e2e2e2">Play</a></li>
				<li><a href="edit.html" id="nav-buttons">Edit</a></li>
				</ul>
			</div>
		</nav>
		
		<!--summon list and field text-->
		<div class="row">
			<div class="col s2">
				<table id="summon-table">
				  <tr>
					<th>Summon List</th>
				  </tr>
				</table>
			</div>
			<div class="col s6">
				<div class="row">
					<div class="col s6">
						<ul class="field-collection collection droppable">
							<li class="collection-item">
								<span class="field-title-name title"></span>
								HP: <input id="field-title-hp" class="browser-default" type="number" oninput="checkStatValue(this)"></span>
								ATK: <input id="field-title-atk" class="browser-default" type="number" oninput="checkStatValue(this)"></span>
								TCD: <input id="field-title-tcd" class="browser-default" type="number" oninput="checkStatValue(this)"></span>
								<i onclick="swap(this)" id="field-swap" class="material-icons">swap_horiz</i>
								<p>
								<text id="ability">Ability:</text><br>
								<text id="passive">Passive:</text><br>
								<text id="flavor-text"></text>
								</p>
							</li>
						</ul>
						<ul class="field-collection collection droppable">
							<li class="collection-item">
								<span class="field-title-name title"></span>
								HP: <input id="field-title-hp" class="browser-default" type="number" oninput="checkStatValue(this)"></span>
								ATK: <input id="field-title-atk" class="browser-default" type="number" oninput="checkStatValue(this)"></span>
								TCD: <input id="field-title-tcd" class="browser-default" type="number" oninput="checkStatValue(this)"></span>
								<i onclick="swap(this)" id="field-swap" class="material-icons">swap_horiz</i>
								<p>
								<text id="ability">Ability:</text><br>
								<text id="passive">Passive:</text><br>
								<text id="flavor-text"></text>
								</p>
							</li>
						</ul>
						<hr>
						<ul class="field-collection collection droppable">
							<li class="collection-item">
								<span class="field-title-name title"></span>
								HP: <input id="field-title-hp" class="browser-default" type="number" oninput="checkStatValue(this)"></span>
								ATK: <input id="field-title-atk" class="browser-default" type="number" oninput="checkStatValue(this)"></span>
								TCD: <input id="field-title-tcd" class="browser-default" type="number" oninput="checkStatValue(this)"></span>
								<i onclick="swap(this)" id="field-swap" class="material-icons">swap_horiz</i>
								<p>
								<text id="ability">Ability:</text><br>
								<text id="passive">Passive:</text><br>
								<text id="flavor-text"></text>
								</p>
							</li>
						</ul>
						<ul class="field-collection collection droppable">
							<li class="collection-item">
								<span class="field-title-name title"></span>
								HP: <input id="field-title-hp" class="browser-default" type="number" oninput="checkStatValue(this)"></span>
								ATK: <input id="field-title-atk" class="browser-default" type="number" oninput="checkStatValue(this)"></span>
								TCD: <input id="field-title-tcd" class="browser-default" type="number" oninput="checkStatValue(this)"></span>
								<i onclick="swap(this)" id="field-swap" class="material-icons">swap_horiz</i>
								<p>
								<text id="ability">Ability:</text><br>
								<text id="passive">Passive:</text><br>
								<text id="flavor-text"></text>
								</p>
							</li>
						</ul>
					</div>
					<div class="col s6 push-s4">
						<ul class="field-collection collection droppable" style="margin-top: 100px">
							<li class="collection-item">
								<span class="field-title-name title"></span>
								HP: <input id="field-title-hp" class="browser-default" type="number" oninput="checkStatValue(this)"></span>
								ATK: <input id="field-title-atk" class="browser-default" type="number" oninput="checkStatValue(this)"></span>
								TCD: <input id="field-title-tcd" class="browser-default" type="number" oninput="checkStatValue(this)"></span>
								<i onclick="swap(this)" id="field-swap" class="material-icons">swap_horiz</i>
								<p>
								<text id="ability">Ability:</text><br>
								<text id="passive">Passive:</text><br>
								<text id="flavor-text"></text>
								</p>
							</li>
						</ul>
						<ul class="field-collection collection droppable" style="margin-top: 175px">
							<li class="collection-item">
								<span class="field-title-name title"></span>
								HP: <input id="field-title-hp" class="browser-default" type="number" oninput="checkStatValue(this)"></span>
								ATK: <input id="field-title-atk" class="browser-default" type="number" oninput="checkStatValue(this)"></span>
								TCD: <input id="field-title-tcd" class="browser-default" type="number" oninput="checkStatValue(this)"></span>
								<i onclick="swap(this)" id="field-swap" class="material-icons">swap_horiz</i>
								<p>
								<text id="ability">Ability:</text><br>
								<text id="passive">Passive:</text><br>
								<text id="flavor-text"></text>
								</p>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</main>

	<footer>

	</footer>
	
	<script>
		//swap variables to swap selected collections
		var swap1 = false;
		var swap2 = false;
		var summonIndex1 = "";
		var summonTitle1 = "";
		var summonHP1 = "";
		var summonATK1 = "";
		var summonTCD1 = "";
		var summonAbility1 = "";
		var summonPassive1 = "";
		var summonFlavorText1 = "";
		
		//get all the summons from the localStorage, and put it onto a table
		for(var i = 0; i < localStorage.length; i++) {
			//unparse the summon's JSON to get its name
			var summonIndex = "summon" + i;
			//continuously check if a summon exists for the index until we cannot find one
			if(localStorage.getItem(summonIndex) && localStorage.getItem(summonIndex) != "None") {
				//add new node within the table
				var summonName = JSON.parse(localStorage.getItem(summonIndex)).name;
				var nodeTR = document.createElement("tr");
				var nodeTD = document.createElement("td");
				summonName = document.createTextNode(summonName);
				nodeTD.appendChild(summonName);
				nodeTD.setAttribute("data-index", (summonIndex));
				nodeTD.id = "summon";
				nodeTD.className = "draggable";
				nodeTR.appendChild(nodeTD);
				var table = document.getElementById("summon-table");
				table.appendChild(nodeTR);
			}
		}
		
		//draggable summons (revert when it hits a droppable, and make its z-index stack above divs)
		$(".draggable").draggable({revert: "valid", stack: "div"});
		
		//droppable field collections
		$( ".droppable" ).droppable({
			classes: {},
				drop: function(event, ui) {
				/*once an item has been dropped, get its information*/
				var summonIndex = $(ui.draggable).attr("data-index");
				var summonName = $(ui.draggable).text();
				var HP = 1;
				var ATK = 1;
				var TCD = 1;
				var ability = "?";
				var passive = "?";
				var flavorText = "No biography on this summon...";
				
				//set the target collection to the dragged summon's information
				$(this).find(".field-title-name").html(summonName + " - ");
				$(this).find(".field-title-name").attr("data-index", summonIndex);
				$(this).find("#field-title-hp").val(JSON.parse(localStorage.getItem(summonIndex)).hp);
				$(this).find("#field-title-atk").val(JSON.parse(localStorage.getItem(summonIndex)).atk);
				$(this).find("#field-title-tcd").val(JSON.parse(localStorage.getItem(summonIndex)).tcd);
				$(this).find("#ability").html("Ability: " + JSON.parse(localStorage.getItem(summonIndex)).ability);
				$(this).find("#passive").html("Passive: " + JSON.parse(localStorage.getItem(summonIndex)).passive);
				$(this).find("#flavor-text").html(JSON.parse(localStorage.getItem(summonIndex)).flavortext);
			}
		});
		
		function checkStatValue(element) {
			//if the value is less than 0 and its a summoner, then reset to the stat's original value
			var summonIndex = element.parentNode.querySelector('.field-title-name').getAttribute("data-index");
			if (element.value < 0 && summonIndex) {
				//check what specific field we edited
				if(element.id == "field-title-hp") {
					element.value = JSON.parse(localStorage.getItem(summonIndex)).hp;
				} else if(element.id == "field-title-atk") {
					element.value = JSON.parse(localStorage.getItem(summonIndex)).atk;
				} else if(element.id == "field-title-tcd") {
					element.value = JSON.parse(localStorage.getItem(summonIndex)).tcd;
				}
			} else if(!summonIndex){
				element.value = 0;
			}
		}
		var test
		function swap(element) {
			//check if this is our first selected swap item
			if(swap1 == false) {
				element.parentNode.style.backgroundColor = "#35ea75";
				summonIndex1 = element.parentNode.querySelector('.field-title-name');
				summonTitle1 = element.parentNode.querySelector('.field-title-name');
				summonHP1 = element.parentNode.querySelector('#field-title-hp');
				summonATK1 = element.parentNode.querySelector('#field-title-atk');
				summonTCD1 = element.parentNode.querySelector('#field-title-tcd');
				summonAbility1 = element.parentNode.querySelector('#ability');
				summonPassive1 = element.parentNode.querySelector('#passive');
				summonFlavorText1 = element.parentNode.querySelector('#flavor-text');
				swap1 = true;
			//else, we're dealing with the second selected swap item so now let's swap the two
			} else if(swap1 == true && swap2 == false) {
				var summonIndex2 = element.parentNode.querySelector('.field-title-name').getAttribute("data-index");
				var summonTitle2 = element.parentNode.querySelector('.field-title-name').innerHTML;
				var summonHP2 = element.parentNode.querySelector('#field-title-hp').value;
				var summonATK2 = element.parentNode.querySelector('#field-title-atk').value;
				var summonTCD2 = element.parentNode.querySelector('#field-title-tcd').value;
				var summonAbility2 = element.parentNode.querySelector('#ability').innerHTML;
				var summonPassive2 = element.parentNode.querySelector('#passive').innerHTML;
				var summonFlavorText2 = element.parentNode.querySelector('#flavor-text').innerHTML;
				
				//swap the two items
				element.parentNode.querySelector('.field-title-name').setAttribute("data-index", summonIndex1.getAttribute("data-index"));
				element.parentNode.querySelector('.field-title-name').innerHTML = summonTitle1.innerHTML;
				element.parentNode.querySelector('#field-title-hp').value = summonHP1.value;
				element.parentNode.querySelector('#field-title-atk').value = summonATK1.value;
				element.parentNode.querySelector('#field-title-tcd').value = summonTCD1.value;
				element.parentNode.querySelector('#ability').innerHTML = summonAbility1.innerHTML;
				element.parentNode.querySelector('#passive').innerHTML = summonPassive1.innerHTML;
				element.parentNode.querySelector('#flavor-text').innerHTML = summonFlavorText1.innerHTML;
				summonIndex1.parentNode.style.backgroundColor = "white";
				summonIndex1.setAttribute("data-index", summonIndex2);
				summonTitle1.innerHTML = summonTitle2;
				summonHP1.value = summonHP2;
				summonATK1.value = summonATK2;
				summonTCD1.value = summonTCD2;
				summonAbility1.innerHTML = summonAbility2;
				summonPassive1.innerHTML = summonPassive2;
				summonFlavorText1.innerHTML = summonFlavorText2;
				swap1 = false;
				swap2 = false;
			}
			
			
		}
	</script>
</body>
</html>